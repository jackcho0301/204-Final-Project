<!DOCTYPE html>
<html lang="en">

<head>
    <title>Movie Search</title>
    <link href="tmdb.css" type="text/css" rel="stylesheet">
</head>

<body>

    <!-- <div id="big">
        <button class="btn" id="close_button">CLOSE</button>
        <button class="btn" id="prev_button">&lt;</button>
        <button class="btn" id="next_button">&gt;</button>
      </div> -->

    <div id="form_container">
        <form id="form">
            <label for="input">Search Movie:</label>
            <!-- <input type="text" class="form-control" id="first-name" value="Michael" required> -->
            <input type="text" id="input">
            <button type="submit" id="search-btn">Add</button>
        </form>
    </div>

    <button type="submit" id="popular-btn">See Popular</button>
    <button type="submit" id="latest-btn">See Top-Rated</button>

    <div id="container">
    </div>


    <!-- ++++++++++++++++++++++++++++++++++++++ -->

    <script>

        //my key:
        //0c1cfc186512612b10c8d9f9fe03adb2

        //cloverfield video:
        // https://www.youtube.com/watch?v=
        // 8brYvhEg5Aw

        //for video:
        //use this request:
        //https://api.themoviedb.org/3/movie/{movie_id}/videos?api_key=<<api_key>>&language=en-US
        //movie id 384521
        //api key: 0c1cfc186512612b10c8d9f9fe03adb2
        //ex: 
        // https://api.themoviedb.org/3/movie/384521/videos?api_key=0c1cfc186512612b10c8d9f9fe03adb2&language=en-US
        //and then get the key
        //and append key to:
        //https://www.youtube.com/watch?v=



        const form = document.getElementById("form");
        form.addEventListener("submit", search, false);

        const popularButton = document.getElementById("popular-btn");
        popularButton.addEventListener("click", seePopular, false);

        const latestButton = document.getElementById("latest-btn");
        latestButton.addEventListener("click", seeTopRated, false);

        //see popular upon load:
        seePopular();

        function clicked(event) {
            console.log("clicked");
            // poster.style.border = "5px solid blue";
            event.target.style.border = "5px solid blue";
        }

        function borderAppear(event) {
            event.target.style.border = "5px solid red";
        }

        function borderDisappear(event) {
            event.target.style.border = "5px solid white";
        }



        //search movies:
        function search(event) {
            event.preventDefault();
            var input = document.getElementById("input");
            var inputValue = input.value;

            var posterContainer = document.getElementById("container");
            posterContainer.innerHTML = "";

            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    var results = JSON.parse(this.responseText);
                    for (var i = 0; i < results.results.length; i++) {

                        if (results.results[i].poster_path != null) {
                            var poster = document.createElement("img");
                            poster.setAttribute("src", "https://image.tmdb.org/t/p/original" + results.results[i].poster_path);
                            poster.setAttribute("class", "posters");
                            posterContainer.appendChild(poster);
                        }
                        if (results.results[i].poster_path == null) {
                            var poster = document.createElement("img");
                            poster.setAttribute("src", "poster_null.png");
                            poster.setAttribute("class", "posters");
                            posterContainer.appendChild(poster);
                        }
                    }
                   

                }
            };
            xhttp.open("GET", "https://api.themoviedb.org/3/search/movie?api_key=0c1cfc186512612b10c8d9f9fe03adb2&query=" + inputValue, true);
            xhttp.send();
        }

        //see popular movies:
        function seePopular() {
            var posterContainer = document.getElementById("container");
            posterContainer.innerHTML = "";
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    var results = JSON.parse(this.responseText);

                    for (var i = 0; i < results.results.length; i++) {
                        if (results.results[i].poster_path != null) {
                            var poster = document.createElement("img");
                            poster.setAttribute("src", "https://image.tmdb.org/t/p/original" + results.results[i].poster_path);
                            poster.setAttribute("class", "posters")
                            posterContainer.appendChild(poster);
                        }
                        if (results.results[i].poster_path == null) {
                            var poster = document.createElement("img");
                            poster.setAttribute("src", "poster_null.png");
                            poster.setAttribute("class", "posters")
                            posterContainer.appendChild(poster);
                        }
                    }
                    var allPosters = document.getElementsByClassName("posters");
                    for (var i = 0; i < allPosters.length; i++) {
                        allPosters[i].style.border = "5px solid white";
                        allPosters[i].addEventListener("click", clicked);
                        allPosters[i].addEventListener("mouseover", borderAppear);
                        allPosters[i].addEventListener("mouseout", borderDisappear);
                    }
                }
            };
            xhttp.open("GET", "https://api.themoviedb.org/3/movie/popular?api_key=0c1cfc186512612b10c8d9f9fe03adb2&language=en-US&page=1", true);
            xhttp.send();
        }

        //see top rated movies:
        function seeTopRated() {
            var posterContainer = document.getElementById("container");
            posterContainer.innerHTML = "";
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    var results = JSON.parse(this.responseText);

                    for (var i = 0; i < results.results.length; i++) {
                        if (results.results[i].poster_path != null) {
                            var poster = document.createElement("img");
                            poster.setAttribute("src", "https://image.tmdb.org/t/p/original" + results.results[i].poster_path);
                            poster.setAttribute("class", "posters")
                            posterContainer.appendChild(poster);
                        }
                        if (results.results[i].poster_path == null) {
                            var poster = document.createElement("img");
                            poster.setAttribute("src", "poster_null.png");
                            poster.setAttribute("class", "posters")
                            posterContainer.appendChild(poster);
                        }
                    }
                }
            };
            xhttp.open("GET", "https://api.themoviedb.org/3/movie/top_rated?api_key=0c1cfc186512612b10c8d9f9fe03adb2&language=en-US&page=1", true);
            xhttp.send();
        }


    </script>

</body>

</html>